### 定时器处理非活动连接

由于非活跃连接占用了连接资源，严重影响服务器的性能，通过实现一个服务器定时器，处理这种非活跃连接，释放连接资源。利用alarm函数周期性地触发SIGALRM信号,该信号的信号处理函数利用管道通知主循环执行定时器链表上的定时任务.

#### 基础知识

* 非活跃: 客户端(这里是游览器)与服务器建立连接后，长时间不交换数据，一直占用服务器端的
文件描述符，导致连接资源的浪费.
* 定时事件: 一段时间之后触发某段代码，执行代码逻辑，例如本项目定时handler从内核事件表删除
事件，关闭文件描述符，释放连接资源.
* 定时器: 利用结构体或其他形式，将多种定时事件封装起来. 本项目只涉及一种定时事件，
即定期监测非活跃连接，这里将定时事件和连接资源封装为一个结构体定时器.
* 定时器容器: 使用某种容器管理多个定时器，便于对定时事件的统一管理. 本项目使用升序列表.

#### 整体概述

本项目中，服务器主循环为每一个连接创建一个定时器，并对每个连接进行定时。
利用升序事件链表管理所有定时器。当主循环收到定时通知，在链表中监测是否有事件超时。

Linux 提供了三种定时方法.

* socket选项SO_RECVTIMEO和SO_SNDTIMEO
* SIGALRM信号
* I/O复用系统调用的超时参数

#### 信号通知流程

Linux 下信号采用异步处理机制，信号的发生不由程序运行流确定.
当进程收到信号时，OS会中断进程当前的执行流，转而执行信号处理函数handler,
完成handler后再返回中断的地方继续执行.

为避免信号竞态现象发生，信号处理期间系统不会再次触发. 所以，
为确保其他信号不被屏蔽太久，信号处理函数需要尽可能块地完成.

这里为避免信号处理函数执行时间过长，信号处理函数仅仅将出现信号的
信息通知给程序主循环，将信号处理的具体逻辑放在程序的主循环中.

#### 统一事件源

将所有事件: 信号，I/O事件(客户端连接，客户端请求事件，将http响应报文写入客户端事件)
统一处理. 

本项目中信号处理函数使用管道将信号传递给主循环, 使用I/O复用系统epoll监测.
这样信号事件 和 其他文件描述符 都可以通过 epoll 监测，统一处理.

